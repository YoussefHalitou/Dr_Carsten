server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;

  # MIME Types für CSS und andere Assets
  # This ensures CSS files are served with Content-Type: text/css
  # and JS files with Content-Type: application/javascript
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # Content-Security-Policy: Allow iframe embedding from chatbotcarsten.live and Netlify domains
  # This is required for the chatbot to work when embedded on external sites
  # frame-ancestors allows the page to be embedded in iframes from these origins
  add_header Content-Security-Policy "frame-ancestors 'self' https://chatbotcarsten.live https://cosmic-jalebi-b78f17.netlify.app https://*.netlify.app" always;
  
  # DO NOT set X-Frame-Options - it conflicts with CSP frame-ancestors
  # CSP frame-ancestors is the modern, more flexible way to control iframe embedding
  
  # CORS Headers für iframe-Einbindung (optional, but helps with some edge cases)
  # Note: CORS is primarily handled by the backend, but these headers can help
  # with static asset loading in some scenarios
  add_header Access-Control-Allow-Origin * always;
  add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
  add_header Access-Control-Allow-Headers "Content-Type, X-API-Key" always;

  location / {
    try_files $uri $uri/ /index.html;
  }

  location /health {
    return 200 'ok';
  }

  # Cache-Control für Assets
  location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
  }
}
